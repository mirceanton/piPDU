---
image: busybox:latest

variables:
  CI_REGISTRY_IMAGE: "$DOCKERHUB_USER/api-server"

before_script:
  - cd server/src/api-server

build-release:
  stage: build
  script:
    - echo "Do your build here"
  only:
    - main

build-dev:
  stage: build
  image:
    name: gcr.io/kaniko-project/executor:debug
    entrypoint: [""]
  script:
    - export BUILD_VERSION=$(cat VERSION | tr -d '\n')
    - docker login -u $DOCKERHUB_USER -p $DOCKERHUB_TOKEN
    - /kaniko/executor
      --context .
      --dockerfile Dockerfile
      --destination $CI_REGISTRY_IMAGE:$BUILD_VERSION
      --cache
  except:
    - main
